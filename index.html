<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interprofessional Ethical Practice - Interactive Learning</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: white;
            padding: 25px 30px;
            border-radius: 20px 20px 0 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .header h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
        }

        .header p {
            opacity: 0.8;
            font-size: 0.95em;
        }

        .progress-container {
            background: white;
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
        }

        .progress-info {
            font-weight: 600;
            color: #333;
            font-size: 0.9em;
        }

        .progress-bar {
            flex: 1;
            height: 8px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.5s ease;
        }

        .content {
            background: white;
            border-radius: 0 0 20px 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            min-height: 600px;
            max-height: 700px;
            overflow-y: auto;
            padding: 30px;
            scroll-behavior: smooth;
        }

        .content::-webkit-scrollbar {
            width: 8px;
        }

        .content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .content::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 10px;
        }

        .intro-screen {
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .intro-screen h2 {
            color: #333;
            margin-bottom: 20px;
        }

        .intro-screen p, .intro-screen ul {
            color: #666;
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .intro-screen ul {
            margin-left: 30px;
        }

        .ai-notice {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .ai-notice strong {
            color: #856404;
        }

        .key-concepts {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .key-concepts h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .concept-item {
            margin-bottom: 12px;
            padding-left: 10px;
            border-left: 3px solid #667eea;
        }

        .concept-item strong {
            color: #333;
        }

        .button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            border-radius: 30px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: 600;
            margin-top: 20px;
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .button:active {
            transform: translateY(0);
        }

        /* Chat Interface Styles */
        .chat-container {
            animation: fadeIn 0.5s ease;
        }

        .message {
            margin-bottom: 20px;
            animation: slideIn 0.4s ease;
            opacity: 0;
            animation-fill-mode: forwards;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(15px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.narrator {
            text-align: center;
        }

        .message.narrator .bubble {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-left: 4px solid #2196f3;
            display: inline-block;
            max-width: 85%;
            margin: 0 auto;
        }

        .message.character-left .bubble {
            background: #f5f5f5;
            border-radius: 20px 20px 20px 5px;
            max-width: 75%;
        }

        .message.character-right .bubble {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px 20px 5px 20px;
            max-width: 75%;
            margin-left: auto;
        }

        .message.character-left {
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .message.character-right {
            display: flex;
            flex-direction: row-reverse;
            align-items: flex-start;
            gap: 12px;
        }

        .character-avatar {
            font-size: 40px;
            flex-shrink: 0;
        }

        .bubble {
            padding: 15px 20px;
            border-radius: 15px;
            line-height: 1.6;
        }

        .character-name {
            font-weight: 700;
            margin-bottom: 5px;
            font-size: 0.9em;
            opacity: 0.9;
        }

        .message.narrator .character-name {
            color: #1976d2;
        }

        .message.character-left .character-name {
            color: #555;
        }

        .message.character-right .character-name {
            color: rgba(255, 255, 255, 0.95);
        }

        .bubble-text {
            font-size: 1.05em;
        }

        .question-prompt {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            padding: 20px;
            border-radius: 15px;
            border-left: 4px solid #ff9800;
            margin: 25px 0;
            text-align: center;
            font-weight: 600;
            color: #e65100;
            animation: slideIn 0.4s ease;
        }

        .answer-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 20px 0;
        }

        .answer-option {
            background: white;
            border: 3px solid #e0e0e0;
            padding: 18px 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            animation: slideIn 0.4s ease;
            text-align: center;
        }

        .answer-option:hover {
            border-color: #667eea;
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .answer-option.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #f3f4ff 0%, #e8eaff 100%);
        }

        .answer-label {
            font-weight: 700;
            font-size: 1.1em;
            color: #333;
        }

        .feedback-section {
            margin-top: 25px;
        }

        .feedback-bubble {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border-left: 4px solid #4caf50;
            padding: 20px;
            border-radius: 15px;
            margin: 15px 0;
            animation: slideIn 0.4s ease;
        }

        .feedback-bubble.incorrect {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            border-left: 4px solid #ff9800;
        }

        .feedback-title {
            font-weight: 700;
            font-size: 1.1em;
            margin-bottom: 10px;
            color: #2e7d32;
        }

        .feedback-bubble.incorrect .feedback-title {
            color: #e65100;
        }

        .feedback-text {
            line-height: 1.7;
            color: #333;
        }

        .reflection-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border: 2px dashed #d0d0d0;
        }

        .reflection-section label {
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .reflection-section textarea {
            width: 100%;
            min-height: 80px;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-family: inherit;
            font-size: 1em;
            resize: vertical;
            transition: border-color 0.3s;
        }

        .reflection-section textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            justify-content: center;
        }

        .button-secondary {
            background: #6c757d;
        }

        .button-secondary:hover {
            box-shadow: 0 10px 20px rgba(108, 117, 125, 0.4);
        }

        /* Results Screen */
        .results-screen {
            animation: fadeIn 0.5s ease;
        }

        .results-score {
            font-size: 3em;
            font-weight: bold;
            text-align: center;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 20px 0;
        }

        .results-summary {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
        }

        .stat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            margin-top: 8px;
            font-size: 0.9em;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.4em;
            }

            .content {
                padding: 20px;
                max-height: 600px;
            }

            .message.character-left .bubble,
            .message.character-right .bubble {
                max-width: 85%;
            }

            .character-avatar {
                font-size: 35px;
            }

            .button-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéì Interprofessional Ethical Practice</h1>
            <p>Interactive Learning Journey</p>
        </div>

        <div class="progress-container">
            <div class="progress-info" id="progress-info">Ready to begin</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
            </div>
        </div>

        <div class="content" id="content">
            <!-- Intro Screen -->
            <div id="intro-screen" class="intro-screen">
                <h2>Welcome to Your Learning Journey! üëã</h2>
                
                <div class="ai-notice">
                    <strong>üì± Note:</strong> These are AI-generated cases designed to simulate real-world ethical challenges that healthcare professionals encounter in practice.
                </div>

                <p>You're about to experience complex ethical situations through interactive stories. Through these narratives, you'll learn to distinguish between three critical types of ethical challenges.</p>

                <div class="key-concepts">
                    <h3>üéØ What You'll Learn:</h3>
                    
                    <div class="concept-item">
                        <strong>Ethical Uncertainty</strong><br>
                        <span style="color: #666;">When you're unsure which ethical principle applies or what the right action should be.</span>
                    </div>
                    
                    <div class="concept-item">
                        <strong>Ethical Dilemma</strong><br>
                        <span style="color: #666;">When you must choose between two or more conflicting ethical principles, each with valid justification.</span>
                    </div>
                    
                    <div class="concept-item">
                        <strong>Ethical Distress</strong><br>
                        <span style="color: #666;">When you know the right thing to do but external constraints prevent you from acting on it.</span>
                    </div>
                </div>

                <p><strong>What makes this different?</strong> Instead of dry case studies, you'll experience these situations through interactive conversations with physiotherapists, occupational therapists, speech-language pathologists, and audiologists as they navigate real clinical challenges.</p>

                <p>Take your time with each scenario. Think critically. There's more nuance here than you might expect! ü§î</p>

                <div style="text-align: center;">
                    <button class="button" onclick="startLearning()">Begin Your Journey üöÄ</button>
                </div>
            </div>

            <!-- Chat Screen -->
            <div id="chat-screen" class="chat-container hidden"></div>

            <!-- Results Screen -->
            <div id="results-screen" class="results-screen hidden"></div>
        </div>
    </div>

    <script>
        // All 20 narrative cases
        const narrativeCases = [
            // CASE 1 - Easy - Pain Management Uncertainty
            {
                id: 1,
                difficulty: "Easy",
                profession: "Physiotherapy",
                messages: [
                    { type: "narrator", name: "Narrator", text: "Marcus works at a community rehabilitation center, treating patients recovering from various orthopedic surgeries." },
                    { type: "character", name: "Marcus", emoji: "üë®‚Äç‚öïÔ∏è", side: "left", text: "Mrs. Thompson, you're making good progress! Your range of motion is improving nicely." },
                    { type: "character", name: "Mrs. Thompson's daughter", emoji: "üë©", side: "right", text: "That's great! We keep meaning to ask you‚Äîwhen should Mom take her pain medication? Before therapy? After? We're not sure what's best." },
                    { type: "character", name: "Marcus", emoji: "üë®‚Äç‚öïÔ∏è", side: "left", text: "Hmm... I want to help manage her pain effectively, but I'm also worried about dependency risks. I'm not quite sure which approach I should be recommending here." },
                    { type: "narrator", name: "Narrator", text: "Marcus has been asked about pain medication timing frequently by families lately." }
                ],
                question: "What type of ethical challenge is Marcus experiencing?",
                correctAnswer: "uncertainty",
                feedback: {
                    correct: {
                        initial: "Excellent! You've correctly identified this as ethical uncertainty.",
                        exploration: "Marcus isn't facing a choice between two clear principles (which would be a dilemma), and he's not being prevented from acting (which would be distress). Instead, he's genuinely unsure about what ethical principle should guide him. The values involved‚Äîpain management versus dependency prevention‚Äîaren't yet clearly defined in his mind as conflicting principles. He needs more information or reflection to clarify the situation.",
                        consideration: "You might have been tempted to call this a dilemma because there are two concerns (pain vs. dependency). But notice: Marcus hasn't yet identified these as specific ethical principles in conflict. He's at an earlier stage‚Äîstill figuring out the ethical landscape. That confusion is the hallmark of uncertainty."
                    },
                    incorrect: {
                        initial: "Let's think through this together. I can see why you chose that answer!",
                        guidance: "Consider what Marcus is experiencing: He's not being blocked by external forces (which would be distress), and he hasn't yet identified a clear conflict between two ethical principles (which would be a dilemma). Instead, Marcus is genuinely confused about what ethical principle should guide his practice.",
                        hint: "The key phrase is 'I'm not quite sure which approach I should be recommending.' He's still trying to figure out the ethical framework that applies. This confusion about what the right approach should be is characteristic of ethical uncertainty.",
                        resolution: "This is ethical uncertainty. Marcus needs more information or reflection to clarify which ethical principles apply to pain medication discussions. Once he has that clarity, he might face a dilemma‚Äîbut right now, he's in the uncertain phase."
                    }
                },
                reflectionPrompt: "What resources or consultations might help Marcus gain clarity about his role in pain management discussions?"
            },

            // CASE 2 - Easy - Administrative Pressure (Distress)
            {
                id: 2,
                difficulty: "Easy",
                profession: "Speech-Language Pathology",
                messages: [
                    { type: "narrator", name: "Narrator", text: "Sarah has been working in hospital settings for three years. She's currently treating Mr. Chen, a stroke patient with significant dysphagia." },
                    { type: "character", name: "Sarah", emoji: "üë©‚Äç‚öïÔ∏è", side: "left", text: "Mr. Chen needs at least two more weeks of intensive therapy to be safe with oral intake. The progress is there, but it's going to take time." },
                    { type: "narrator", name: "Narrator", text: "An email arrives from hospital administration." },
                    { type: "character", name: "Hospital Administrator", emoji: "üíº", side: "right", text: "Reminder: Due to efficiency targets, limit dysphagia assessments to 15 minutes. Patients should be discharged within 7 days when insurance doesn't cover extended stay." },
                    { type: "character", name: "Sarah", emoji: "üë©‚Äç‚öïÔ∏è", side: "left", text: "I know exactly what Mr. Chen needs‚Äî30-45 minute sessions for proper assessment and therapy. But I'm being told to cut corners and discharge him early. This is so frustrating." }
                ],
                question: "What type of ethical challenge is Sarah experiencing?",
                correctAnswer: "distress",
                feedback: {
                    correct: {
                        initial: "Spot on! This is a clear case of ethical distress.",
                        exploration: "Sarah knows exactly what she should do (provide 30-45 minute sessions for proper dysphagia assessment and treatment). She's not confused about the right course of action, and she's not choosing between two valid principles. Instead, external forces‚Äîadministrative pressure and insurance limitations‚Äîare preventing her from acting on her professional knowledge.",
                        consideration: "The frustration Sarah feels is characteristic of ethical distress. She's experiencing the powerlessness that comes from knowing the right path but being unable to follow it due to institutional barriers."
                    },
                    incorrect: {
                        initial: "I can see why you might think that, but let's look more closely at Sarah's situation.",
                        guidance: "Notice that Sarah has absolute clarity about what needs to be done. She's not confused (so it's not uncertainty), and she's not choosing between two conflicting but valid principles (so it's not a dilemma). Instead, she explicitly knows the right course of action.",
                        hint: "The key is in Sarah's statement: 'I know exactly what Mr. Chen needs.' She has professional knowledge of best practice. The problem? External constraints‚Äîadministrative policies and insurance denials‚Äîare preventing her from acting on that knowledge.",
                        resolution: "This is ethical distress. Sarah is experiencing the frustration of knowing what's right but being blocked by institutional barriers. This sense of powerlessness, despite having clear knowledge, is the defining feature of ethical distress."
                    }
                },
                reflectionPrompt: "What advocacy strategies could Sarah use to challenge policies that contradict evidence-based practice?"
            },

            // CASE 3 - Easy - Budget Constraints (Distress)
            {
                id: 3,
                difficulty: "Easy",
                profession: "Occupational Therapy",
                messages: [
                    { type: "narrator", name: "Narrator", text: "Alex is an occupational therapist at an elementary school. One of her students, Emma, has been showing remarkable progress with sensory integration therapy." },
                    { type: "character", name: "Alex", emoji: "üë©‚Äç‚öïÔ∏è", side: "left", text: "Emma would really benefit from a therapy swing and weighted compression vest. I've completed the assessment and the research is clear about what would help her succeed." },
                    { type: "character", name: "School Principal", emoji: "üëî", side: "right", text: "Alex, I appreciate your thoroughness, but we have no budget for new equipment this year. You'll need to make do with what we have." },
                    { type: "character", name: "Alex", emoji: "üë©‚Äç‚öïÔ∏è", side: "left", text: "This is heartbreaking. I know what Emma needs, but my hands are tied by budget constraints." }
                ],
                question: "What type of ethical challenge is Alex experiencing?",
                correctAnswer: "distress",
                feedback: {
                    correct: {
                        initial: "Exactly right! Alex is experiencing ethical distress.",
                        exploration: "Alex has complete clarity about the right course of action (providing sensory integration equipment based on a thorough assessment). The challenge isn't about choosing between principles or figuring out what's right‚Äîit's about being prevented from doing what's right by budget limitations.",
                        consideration: "This type of systemic barrier is a common source of ethical distress in healthcare and education settings. The professional knows what's needed, but institutional constraints create a barrier between knowledge and action."
                    },
                    incorrect: {
                        initial: "Let's explore this scenario more carefully together.",
                        guidance: "Think about what Alex is experiencing: There's no confusion about values (so it's not uncertainty). There's no choice between two valid but conflicting principles (so it's not a dilemma). Instead, Alex has clear professional knowledge of what Emma needs.",
                        hint: "Alex states explicitly: 'I know what Emma needs.' The problem isn't about determining the right path‚Äîit's about not being able to follow that path because of external barriers (budget constraints).",
                        resolution: "This is ethical distress. The key indicator is that Alex knows the right intervention but can't provide it due to institutional limitations. That gap between knowledge and ability to act, creating frustration and powerlessness, defines ethical distress."
                    }
                },
                reflectionPrompt: "How might Alex advocate for necessary resources while working within institutional constraints?"
            },

            // CASE 4 - Easy - Student Uncertainty
            {
                id: 4,
                difficulty: "Easy",
                profession: "Audiology",
                messages: [
                    { type: "narrator", name: "Narrator", text: "Jamie, an audiology student, is gaining experience at a community health fair. The day has been going smoothly until an unexpected question arises." },
                    { type: "character", name: "Mr. Martinez", emoji: "üßì", side: "right", text: "Young person, do you think I should get hearing aids? I'm on quite a few medications‚Äîone for my heart, blood pressure medication, plus I see a cardiologist and neurologist regularly." },
                    { type: "character", name: "Jamie", emoji: "üë®‚Äç‚öïÔ∏è", side: "left", text: "Oh... I'm not sure. Could hearing loss interact with his medications? Should I even be making a recommendation? I don't have much experience with complex medical histories like this." },
                    { type: "character", name: "Jamie", emoji: "üë®‚Äç‚öïÔ∏è", side: "left", text: "I want to help, but I'm honestly questioning which path aligns with best practice here." }
                ],
                question: "What type of ethical challenge is Jamie experiencing?",
                correctAnswer: "uncertainty",
                feedback: {
                    correct: {
                        initial: "Well done! You've identified Jamie's ethical uncertainty.",
                        exploration: "Jamie is genuinely unsure about the right course of action. They lack sufficient experience with complex medical histories to know whether immediate recommendation, watchful waiting, or specialist referral is most appropriate. They're not facing institutional barriers (distress) or choosing between known conflicting principles (dilemma)‚Äîthey simply need more information to determine what's ethically appropriate.",
                        consideration: "Notice the key phrase: 'I'm questioning which path aligns with best practice.' This uncertainty about what the right approach should be, given limited experience, is the hallmark of ethical uncertainty."
                    },
                    incorrect: {
                        initial: "That's a reasonable guess, but let's look at what Jamie is really experiencing.",
                        guidance: "Consider: Is Jamie being blocked by external forces? No‚Äîthere are no institutional barriers preventing them from making a recommendation. Is Jamie choosing between two clear ethical principles? Not really‚Äîthey haven't even identified what principles should guide them yet.",
                        hint: "Jamie's challenge is more fundamental: They lack the knowledge and experience to know what the right approach should be. Notice phrases like 'I'm not sure,' 'I don't have much experience,' and 'I'm questioning which path aligns with best practice.'",
                        resolution: "This is ethical uncertainty. Jamie needs more knowledge‚Äîpossibly through consultation with a supervisor or more experienced audiologist‚Äîto gain clarity about what ethical principles should guide practice when patients have complex medical histories."
                    }
                },
                reflectionPrompt: "What steps should healthcare students take when they encounter clinical situations beyond their current knowledge level?"
            },

            // CASE 5 - Medium - Intensive Therapy Dilemma
            {
                id: 5,
                difficulty: "Medium",
                profession: "Speech-Language Pathology",
                messages: [
                    { type: "narrator", name: "Narrator", text: "Dr. Rachel Kim is working with 5-year-old Aiden, who has a significant language delay. His parents have strong views about treatment intensity." },
                    { type: "character", name: "Aiden's parents", emoji: "üë´", side: "right", text: "Dr. Kim, we want Aiden in therapy five days a week, two hours each day. We've read that intensive therapy can lead to breakthroughs, and we can adjust our schedules to make it work." },
                    { type: "character", name: "Dr. Kim", emoji: "üë©‚Äç‚öïÔ∏è", side: "left", text: "I can see how dedicated you are. Intensive therapy could benefit his language skills‚Äîthe research does support that for some children..." },
                    { type: "character", name: "Dr. Kim", emoji: "üë©‚Äç‚öïÔ∏è", side: "left", text: "But I'm also concerned. Aiden is showing signs of fatigue already. Ten hours a week would leave almost no time for play or socializing with peers. Those are crucial for his overall development too." },
                    { type: "narrator", name: "Narrator", text: "Rachel considers the competing considerations before her." }
                ],
                question: "What type of ethical challenge is Dr. Kim experiencing?",
                correctAnswer: "dilemma",
                feedback: {
                    correct: {
                        initial: "Excellent analysis! This is indeed an ethical dilemma.",
                        exploration: "Dr. Kim is caught between two legitimate ethical principles: (1) respecting parental autonomy and their right to make treatment decisions, and (2) beneficence/non-maleficence‚Äîprotecting Aiden from potential harm (burnout, reduced social development, childhood stress). Both principles are valid. Both have ethical justification. There's no clear 'right' answer that satisfies both principles.",
                        consideration: "This is why it's a dilemma rather than uncertainty or distress. Rachel isn't confused about which principles apply (uncertainty), and she's not being blocked from acting (distress). Instead, she must make a difficult choice between two conflicting but valid ethical principles. Whatever she decides, one principle will be compromised."
                    },
                    incorrect: {
                        initial: "I can see why you chose that, but let's examine the nuances of this situation.",
                        guidance: "Consider what Dr. Kim is experiencing: She's not confused about which principles apply‚Äîshe's clearly identified parental autonomy and child welfare. She's also not being prevented from acting by external forces. So what is she facing?",
                        hint: "Rachel must choose between two conflicting ethical principles, each with valid justification: respecting the parents' right to make decisions for their child (autonomy) versus protecting Aiden from potential harm (beneficence/non-maleficence). Both sides have merit.",
                        resolution: "This is an ethical dilemma. The defining feature is the conflict between two valid ethical principles. Rachel must weigh the pros and cons of each option, likely negotiate with the family, and make a choice‚Äîknowing that whichever path she chooses, one legitimate principle will be compromised. That's what makes it a true dilemma."
                    }
                },
                reflectionPrompt: "How should clinicians approach conversations with families when their treatment preferences conflict with professional judgment about potential harm?"
            },

            // CASE 6 - Medium - Return to Sport Dilemma
            {
                id: 6,
                difficulty: "Medium",
                profession: "Physiotherapy",
                messages: [
                    { type: "narrator", name: "Narrator", text: "Chris is treating Elena, a competitive volleyball player recovering from ACL reconstruction. The playoffs are approaching, and Elena is eager to return." },
                    { type: "character", name: "Elena", emoji: "üèÉ", side: "right", text: "Chris, I need to know‚Äîcan I play in the playoffs? They're in two weeks. My team is counting on me, and my coach says if I miss this, I might lose my starting position." },
                    { type: "character", name: "Chris", emoji: "üë®‚Äç‚öïÔ∏è", side: "left", text: "Your strength numbers are meeting our basic benchmarks, and your range of motion looks good on paper..." },
                    { type: "character", name: "Chris", emoji: "üë®‚Äç‚öïÔ∏è", side: "left", text: "But Elena, your neuromuscular control‚Äîthe way your body automatically stabilizes during quick movements‚Äîit's not where I'd want it to be for competitive volleyball. You meet the technical criteria, but there's something else." },
                    { type: "character", name: "Elena", emoji: "üèÉ", side: "right", text: "But you said my strength is good! I can do the movements. This is my career we're talking about. I'm willing to take the risk." },
                    { type: "narrator", name: "Narrator", text: "Chris weighs the competing considerations." }
                ],
                question: "What type of ethical challenge is Chris experiencing?",
                correctAnswer: "dilemma",
                feedback: {
                    correct: {
                        initial: "Exactly! You've recognized this ethical dilemma.",
                        exploration: "Chris is balancing two legitimate ethical principles: (1) respecting Elena's autonomy‚Äîher right to make informed decisions about her body and career, especially given that she meets basic return-to-sport criteria, and (2) his professional duty of beneficence and non-maleficence‚Äîpreventing potential re-injury that could have long-term consequences. Both positions have ethical validity and potential real-world consequences.",
                        consideration: "What makes this a particularly challenging dilemma is that external pressure (from her coach and team) is involved, but the core ethical conflict exists independently of that pressure. Chris must weigh patient autonomy against professional responsibility, with no perfect solution that satisfies both principles."
                    },
                    incorrect: {
                        initial: "Let's think through Chris's situation more carefully.",
                        guidance: "Is Chris confused about which principles apply? No‚Äîhe's clearly identified patient autonomy and professional responsibility for preventing harm. Is he being prevented from acting by external forces? Not really‚Äîhe has the authority to make the clearance decision. So what is he experiencing?",
                        hint: "Chris is facing a conflict between two valid ethical principles: Elena's right to make decisions about her career and body (autonomy) versus his professional obligation to prevent potential re-injury (beneficence/non-maleficence). Both returning her to play and delaying her return have legitimate ethical justifications.",
                        resolution: "This is an ethical dilemma. Chris must make a difficult choice between two conflicting but valid principles. Whatever he decides‚Äîclearing her or asking her to wait‚Äîone legitimate ethical principle will be compromised. That conflict between valid principles, with no clear 'right' answer, is what defines a true ethical dilemma."
                    }
                },
                reflectionPrompt: "How can healthcare professionals balance patient autonomy with protective responsibility when external pressures influence patient decisions?"
            },

            // CASE 7 - Medium - Accepting Gifts Uncertainty
            {
                id: 7,
                difficulty: "Medium",
                profession: "Occupational Therapy",
                messages: [
                    { type: "narrator", name: "Narrator", text: "Taylor has been working with Mrs. Okonkwo for six months following her stroke. The therapeutic relationship has been positive, and Mrs. Okonkwo has made excellent progress." },
                    { type: "character", name: "Mrs. Okonkwo", emoji: "üßì", side: "right", text: "Taylor, you've helped me get my life back. I want to give you this‚Äîit's a handmade quilt. In my culture, we show gratitude to those who help us heal." },
                    { type: "narrator", name: "Narrator", text: "The quilt is clearly valuable and represents hours of work." },
                    { type: "character", name: "Taylor", emoji: "üë®‚Äç‚öïÔ∏è", side: "left", text: "Oh... this is beautiful, Mrs. Okonkwo. I'm not sure if I can accept it though. I know there are policies about gifts, but I also don't want to offend her or disrespect her cultural values. What's the right thing to do here?" },
                    { type: "character", name: "Taylor", emoji: "üë®‚Äç‚öïÔ∏è", side: "left", text: "Is there a monetary threshold? Does it matter that it's handmade versus purchased? Would refusing damage our therapeutic relationship?" }
                ],
                question: "What type of ethical challenge is Taylor experiencing?",
                correctAnswer: "uncertainty",
                feedback: {
                    correct: {
                        initial: "Correct! This is ethical uncertainty.",
                        exploration: "Taylor is genuinely unsure about what the right course of action should be. He hasn't clearly identified conflicting principles (dilemma) and isn't being prevented from acting by external barriers (distress). Instead, he's uncertain about which ethical principles apply to gift-giving, what institutional policies say, and how to balance professional boundaries with cultural sensitivity. He needs more information‚Äîlikely from professional guidelines and supervision‚Äîto determine the appropriate response.",
                        consideration: "Gift-giving situations often create uncertainty because they involve multiple considerations: professional boundaries, cultural respect, therapeutic relationships, and institutional policies. The confusion about how to weigh these factors and what guidelines apply is characteristic of ethical uncertainty."
                    },
                    incorrect: {
                        initial: "Let's work through this situation together.",
                        guidance: "Consider what Taylor is facing: Is he being blocked by clear institutional barriers from accepting the gift? Not exactly‚Äîhe's unsure what the policies even say. Is he choosing between two clear ethical principles? Not really‚Äîhe hasn't yet identified what framework should guide him.",
                        hint: "Notice Taylor's questions: 'Is there a monetary threshold? Does it matter that it's handmade? Would refusing damage our relationship?' These are all questions seeking clarity about what ethical principles and professional standards apply to this situation. He needs more information to determine the right course of action.",
                        resolution: "This is ethical uncertainty. Taylor needs to consult professional guidelines, institutional policies, and possibly his supervisor to gain clarity about how to handle gifts while respecting both professional boundaries and cultural values. Once he has that clarity, he can act appropriately."
                    }
                },
                reflectionPrompt: "What factors should healthcare professionals consider when patients offer gifts, and how can cultural sensitivity be balanced with professional boundaries?"
            },

            // CASE 8 - Medium - Scope of Practice Boundary
            {
                id: 8,
                difficulty: "Medium",
                profession: "Speech-Language Pathology",
                messages: [
                    { type: "narrator", name: "Narrator", text: "Jordan is relatively new to working with adult clients who have complex trauma histories. One client, Michael, has been making good progress with communication goals." },
                    { type: "character", name: "Michael", emoji: "üßë", side: "right", text: "Jordan, you're the first person who's really listened to me. I feel safe here. Can I tell you about what happened to me? The things I've never told anyone?" },
                    { type: "character", name: "Jordan", emoji: "üë®‚Äç‚öïÔ∏è", side: "left", text: "Michael is opening up, which is good for our therapeutic relationship. But is this within my scope? Should I be hearing trauma details, or should I refer him to mental health services?" },
                    { type: "character", name: "Jordan", emoji: "üë®‚Äç‚öïÔ∏è", side: "left", text: "If I redirect him, will it damage the trust we've built? But if I continue, am I practicing outside my boundaries? I'm not sure what the right approach is." }
                ],
                question: "What type of ethical challenge is Jordan experiencing?",
                correctAnswer: "uncertainty",
                feedback: {
                    correct: {
                        initial: "Well done! You've identified ethical uncertainty.",
                        exploration: "Jordan is confused about where professional boundaries lie and unsure which principle should guide practice‚Äîmaintaining the therapeutic relationship or adhering strictly to scope of practice. He hasn't identified a clear conflict between principles (dilemma) and isn't being blocked from acting (distress). Instead, he needs more information to understand what's ethically appropriate in this boundary situation.",
                        consideration: "Scope of practice questions often create uncertainty, especially for newer professionals. The confusion about where boundaries lie, how to balance relationship-building with professional limits, and what to do when clients share information that may be outside one's expertise is characteristic of ethical uncertainty."
                    },
                    incorrect: {
                        initial: "Let's examine Jordan's situation more closely.",
                        guidance: "Is Jordan being prevented from acting by institutional barriers? No. Has he clearly identified two conflicting ethical principles? Not really‚Äîhe's still figuring out what framework should guide him. His challenge is more fundamental.",
                        hint: "Jordan's statements reveal his confusion: 'Is this within my scope? Should I be hearing this? Am I practicing outside my boundaries? I'm not sure what the right approach is.' He needs clarity about professional boundaries and scope of practice before he can determine the appropriate action.",
                        resolution: "This is ethical uncertainty. Jordan needs consultation with more experienced colleagues or his supervisor to gain clarity about how to handle trauma disclosures while maintaining appropriate professional boundaries. This type of uncertainty is common when professionals encounter situations near the edges of their scope."
                    }
                },
                reflectionPrompt: "How can interprofessional collaboration and consultation help navigate situations that may fall near the boundaries of professional scope?"
            },

            // CASE 9 - Medium - Sales Pressure Distress
            {
                id: 9,
                difficulty: "Medium",
                profession: "Audiology",
                messages: [
                    { type: "narrator", name: "Narrator", text: "Dr. Patel works at a private audiology clinic. Recently, the practice owner has been emphasizing business metrics more heavily." },
                    { type: "character", name: "Practice Owner", emoji: "üíº", side: "right", text: "Dr. Patel, I need you to focus on premium hearing aid packages. We have quarterly quotas to meet. Our investors are expecting growth." },
                    { type: "narrator", name: "Narrator", text: "Dr. Patel sees many elderly patients on fixed incomes in the clinic." },
                    { type: "character", name: "Dr. Patel", emoji: "üë©‚Äç‚öïÔ∏è", side: "left", text: "Many of my patients would do perfectly fine with mid-range devices. The premium packages create real financial hardship for them. I know what's appropriate for their needs." },
                    { type: "character", name: "Dr. Patel", emoji: "üë©‚Äç‚öïÔ∏è", side: "left", text: "But I'm being pressured to recommend expensive options for business reasons, not clinical ones. This goes against everything I believe about patient-centered care." }
                ],
                question: "What type of ethical challenge is Dr. Patel experiencing?",
                correctAnswer: "distress",
                feedback: {
                    correct: {
                        initial: "Exactly right! This is ethical distress.",
                        exploration: "Dr. Patel clearly knows what's right (recommending appropriate, affordable devices based on patient needs and assessment) but is unable to act freely on this knowledge due to external pressure (sales quotas and business demands from the employer). She's experiencing frustration from knowing the ethical course of action but facing institutional barriers that push her toward a different path.",
                        consideration: "This type of ethical distress‚Äîwhere business interests conflict with patient-centered care‚Äîis increasingly common in healthcare settings. The professional knows what's right, but financial pressures create a barrier between knowledge and ethical action."
                    },
                    incorrect: {
                        initial: "Let's look at what Dr. Patel is experiencing here.",
                        guidance: "Is Dr. Patel confused about what the right thing to do is? No‚Äîshe clearly states she knows what devices are appropriate for patients. Is she choosing between two valid but conflicting ethical principles? Not exactly‚Äîthe business pressure isn't an ethical principle. What is she facing?",
                        hint: "Dr. Patel explicitly knows the right thing to do: 'I know what's appropriate for their needs.' The problem is external pressure from her employer to act differently for business reasons. This creates a barrier between her professional knowledge and her ability to act on it freely.",
                        resolution: "This is ethical distress. Dr. Patel is experiencing the frustration that comes from knowing what's ethically right but facing institutional pressure to compromise that knowledge for business reasons. The gap between knowing and being able to act freely defines ethical distress."
                    }
                },
                reflectionPrompt: "What strategies can healthcare professionals use to navigate situations where business interests conflict with patient-centered care?"
            },

            // CASE 10 - Medium - Substance Misuse Reporting
            {
                id: 10,
                difficulty: "Medium",
                profession: "Physiotherapy",
                messages: [
                    { type: "narrator", name: "Narrator", text: "Priya has been treating a patient with chronic pain for several months. Recently, she's observed some concerning patterns during their sessions." },
                    { type: "character", name: "Priya", emoji: "üë©‚Äç‚öïÔ∏è", side: "left", text: "I think my patient might be misusing their prescribed opioid medications. The signs are there‚Äîinconsistent stories, behavioral changes, treatment resistance." },
                    { type: "character", name: "Priya", emoji: "üë©‚Äç‚öïÔ∏è", side: "left", text: "But I'm honestly confused about my responsibilities here. Do I talk to the patient first? Contact the physician directly? Is reporting to an oversight body required? How does patient confidentiality factor in?" },
                    { type: "character", name: "Priya", emoji: "üë©‚Äç‚öïÔ∏è", side: "left", text: "I know something needs to happen, but I'm not sure what the correct procedure is or what my scope of responsibility actually includes." }
                ],
                question: "What type of ethical challenge is Priya experiencing?",
                correctAnswer: "uncertainty",
                feedback: {
                    correct: {
                        initial: "Correct! You've identified ethical uncertainty.",
                        exploration: "Priya recognizes there's an ethical issue but is unsure about her specific ethical and legal obligations. She's confused about correct procedures, the balance between patient confidentiality and safety, and her scope of responsibility. These are questions about which principles apply and how to proceed ethically. She's not facing institutional barriers (distress) or choosing between known conflicting principles (dilemma)‚Äîshe needs more information about her professional obligations.",
                        consideration: "Situations involving potential substance misuse often create uncertainty for healthcare professionals, especially regarding mandatory reporting requirements, confidentiality boundaries, and professional responsibilities. The confusion about procedural and ethical obligations is characteristic of uncertainty."
                    },
                    incorrect: {
                        initial: "Let's work through what Priya is facing.",
                        guidance: "Is Priya being blocked from acting by external forces? No‚Äîthere are no institutional barriers preventing her from taking action. Has she identified clear conflicting ethical principles? Not really‚Äîshe hasn't even determined what her responsibilities are yet.",
                        hint: "Notice Priya's questions: 'Do I talk to the patient first? Contact the physician? Is reporting required? How does confidentiality factor in?' These reveal fundamental uncertainty about professional obligations and procedures. She needs to understand what the rules and ethical guidelines say before she can act.",
                        resolution: "This is ethical uncertainty. Priya needs to consult professional guidelines, potentially legal counsel, and her regulatory body to gain clarity about mandatory reporting requirements, confidentiality boundaries, and appropriate procedures for addressing suspected substance misuse. Once she has that clarity, she can act appropriately."
                    }
                },
                reflectionPrompt: "What resources and professional guidelines should be consulted regarding mandatory reporting and patient confidentiality in one's jurisdiction?"
            },
        ];

        // State management
        let currentCaseIndex = 0;
        let userResponses = [];
        let selectedAnswer = null;
        let messageIndex = 0;
        let currentMessages = [];

        function startLearning() {
            document.getElementById('intro-screen').classList.add('hidden');
            document.getElementById('chat-screen').classList.remove('hidden');
            loadCase();
        }

        function updateProgress() {
            const progress = (currentCaseIndex / narrativeCases.length) * 100;
            document.getElementById('progress-fill').style.width = progress + '%';
            document.getElementById('progress-info').textContent = `Case ${currentCaseIndex + 1} of ${narrativeCases.length}`;
        }

        function loadCase() {
            updateProgress();
            const currentCase = narrativeCases[currentCaseIndex];
            currentMessages = currentCase.messages;
            messageIndex = 0;
            selectedAnswer = null;
            
            const chatScreen = document.getElementById('chat-screen');
            chatScreen.innerHTML = '';
            
            showNextMessage();
        }

        function showNextMessage() {
            const currentCase = narrativeCases[currentCaseIndex];
            
            if (messageIndex < currentMessages.length) {
                const message = currentMessages[messageIndex];
                const chatScreen = document.getElementById('chat-screen');
                
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${message.type === 'narrator' ? 'narrator' : 'character-' + message.side}`;
                messageDiv.style.animationDelay = '0s';
                
                if (message.type === 'narrator') {
                    messageDiv.innerHTML = `
                        <div class="bubble">
                            <div class="character-name">${message.name}</div>
                            <div class="bubble-text">${message.text}</div>
                        </div>
                    `;
                } else {
                    messageDiv.innerHTML = `
                        <div class="character-avatar">${message.emoji}</div>
                        <div class="bubble">
                            <div class="character-name">${message.name}</div>
                            <div class="bubble-text">${message.text}</div>
                        </div>
                    `;
                }
                
                chatScreen.appendChild(messageDiv);
                
                // Scroll to bottom smoothly
                setTimeout(() => {
                    chatScreen.parentElement.scrollTop = chatScreen.parentElement.scrollHeight;
                }, 100);
                
                messageIndex++;
                
                // Auto-advance to next message
                setTimeout(() => {
                    showNextMessage();
                }, 1800);
                
            } else {
                // All messages shown, display question
                setTimeout(() => {
                    showQuestion();
                }, 500);
            }
        }

        function showQuestion() {
            const currentCase = narrativeCases[currentCaseIndex];
            const chatScreen = document.getElementById('chat-screen');
            
            const questionDiv = document.createElement('div');
            questionDiv.innerHTML = `
                <div class="question-prompt">
                    üí≠ ${currentCase.question}
                </div>
            `;
            chatScreen.appendChild(questionDiv);
            
            // Scroll to question
            setTimeout(() => {
                chatScreen.parentElement.scrollTop = chatScreen.parentElement.scrollHeight;
            }, 100);
            
            // Show answer options after a brief delay
            setTimeout(() => {
                showAnswerOptions();
            }, 800);
        }

        function showAnswerOptions() {
            const chatScreen = document.getElementById('chat-screen');
            
            const options = [
                { value: 'dilemma', label: 'Ethical Dilemma' },
                { value: 'uncertainty', label: 'Ethical Uncertainty' },
                { value: 'distress', label: 'Ethical Distress' }
            ];
            
            // Shuffle options
            const shuffled = options.sort(() => Math.random() - 0.5);
            
            const optionsDiv = document.createElement('div');
            optionsDiv.className = 'answer-options';
            optionsDiv.innerHTML = shuffled.map(opt => `
                <div class="answer-option" onclick="selectAnswer('${opt.value}')" data-value="${opt.value}">
                    <div class="answer-label">${opt.label}</div>
                </div>
            `).join('');
            
            chatScreen.appendChild(optionsDiv);
            
            setTimeout(() => {
                chatScreen.parentElement.scrollTop = chatScreen.parentElement.scrollHeight;
            }, 100);
        }

        function selectAnswer(answer) {
            selectedAnswer = answer;
            
            // Update UI
            const options = document.querySelectorAll('.answer-option');
            options.forEach(opt => {
                opt.classList.remove('selected');
                if (opt.getAttribute('data-value') === answer) {
                    opt.classList.add('selected');
                }
                opt.style.pointerEvents = 'none';
            });
            
            // Show feedback after brief delay
            setTimeout(() => {
                showFeedback();
            }, 800);
        }

        function showFeedback() {
            const currentCase = narrativeCases[currentCaseIndex];
            const isCorrect = selectedAnswer === currentCase.correctAnswer;
            const feedback = isCorrect ? currentCase.feedback.correct : currentCase.feedback.incorrect;
            const chatScreen = document.getElementById('chat-screen');
            
            // Store response
            userResponses.push({
                caseId: currentCase.id,
                selectedAnswer: selectedAnswer,
                correctAnswer: currentCase.correctAnswer,
                isCorrect: isCorrect
            });
            
            // Create feedback section
            const feedbackSection = document.createElement('div');
            feedbackSection.className = 'feedback-section';
            
            // Initial feedback
            const initialFeedback = document.createElement('div');
            initialFeedback.className = `feedback-bubble ${isCorrect ? '' : 'incorrect'}`;
            initialFeedback.innerHTML = `
                <div class="feedback-title">${isCorrect ? '‚úÖ Excellent!' : 'ü§î Let\'s Think About This'}</div>
                <div class="feedback-text">${feedback.initial}</div>
            `;
            feedbackSection.appendChild(initialFeedback);
            
            chatScreen.appendChild(feedbackSection);
            scrollToBottom();
            
            // Show detailed feedback in stages
            setTimeout(() => {
                if (isCorrect) {
                    showCorrectFeedbackStages(feedback, feedbackSection);
                } else {
                    showIncorrectFeedbackStages(feedback, feedbackSection);
                }
            }, 1500);
        }

        function showCorrectFeedbackStages(feedback, container) {
            // Exploration
            setTimeout(() => {
                const explorationBubble = document.createElement('div');
                explorationBubble.className = 'feedback-bubble';
                explorationBubble.innerHTML = `
                    <div class="feedback-title">üìñ Why This Is Correct</div>
                    <div class="feedback-text">${feedback.exploration}</div>
                `;
                container.appendChild(explorationBubble);
                scrollToBottom();
            }, 500);
            
            // Consideration
            setTimeout(() => {
                const considerationBubble = document.createElement('div');
                considerationBubble.className = 'feedback-bubble';
                considerationBubble.innerHTML = `
                    <div class="feedback-title">üí° Something to Consider</div>
                    <div class="feedback-text">${feedback.consideration}</div>
                `;
                container.appendChild(considerationBubble);
                scrollToBottom();
            }, 2500);
            
            // Nuance if exists
            if (feedback.nuance) {
                setTimeout(() => {
                    const nuanceBubble = document.createElement('div');
                    nuanceBubble.className = 'feedback-bubble';
                    nuanceBubble.innerHTML = `
                        <div class="feedback-title">üéØ Important Nuance</div>
                        <div class="feedback-text">${feedback.nuance}</div>
                    `;
                    container.appendChild(nuanceBubble);
                    scrollToBottom();
                }, 4500);
            }
            
            // Reflection and continue
            setTimeout(() => {
                showReflectionAndContinue();
            }, feedback.nuance ? 6000 : 4000);
        }

        function showIncorrectFeedbackStages(feedback, container) {
            // Guidance
            setTimeout(() => {
                const guidanceBubble = document.createElement('div');
                guidanceBubble.className = 'feedback-bubble incorrect';
                guidanceBubble.innerHTML = `
                    <div class="feedback-title">üîç Let's Examine This</div>
                    <div class="feedback-text">${feedback.guidance}</div>
                `;
                container.appendChild(guidanceBubble);
                scrollToBottom();
            }, 500);
            
            // Hint
            setTimeout(() => {
                const hintBubble = document.createElement('div');
                hintBubble.className = 'feedback-bubble incorrect';
                hintBubble.innerHTML = `
                    <div class="feedback-title">üí≠ Key Insight</div>
                    <div class="feedback-text">${feedback.hint}</div>
                `;
                container.appendChild(hintBubble);
                scrollToBottom();
            }, 2500);
            
            // Resolution
            setTimeout(() => {
                const resolutionBubble = document.createElement('div');
                resolutionBubble.className = 'feedback-bubble';
                resolutionBubble.innerHTML = `
                    <div class="feedback-title">‚ú® The Answer</div>
                    <div class="feedback-text">${feedback.resolution}</div>
                `;
                container.appendChild(resolutionBubble);
                scrollToBottom();
            }, 4500);
            
            // Add nuance if it exists
            if (feedback.nuance) {
                setTimeout(() => {
                    const nuanceBubble = document.createElement('div');
                    nuanceBubble.className = 'feedback-bubble';
                    nuanceBubble.innerHTML = `
                        <div class="feedback-title">üéØ Important Nuance</div>
                        <div class="feedback-text">${feedback.nuance}</div>
                    `;
                    container.appendChild(nuanceBubble);
                    scrollToBottom();
                }, 6500);
            }
            
            // Reflection and continue
            setTimeout(() => {
                showReflectionAndContinue();
            }, feedback.nuance ? 8000 : 6000);
        }

        function showReflectionAndContinue() {
            const currentCase = narrativeCases[currentCaseIndex];
            const chatScreen = document.getElementById('chat-screen');
            
            const reflectionDiv = document.createElement('div');
            reflectionDiv.className = 'reflection-section';
            reflectionDiv.innerHTML = `
                <label>üí≠ Reflection Question (Optional)</label>
                <p style="color: #666; margin: 10px 0; font-size: 0.95em;">${currentCase.reflectionPrompt}</p>
                <textarea id="reflection-text" placeholder="Share your thoughts (optional)..."></textarea>
            `;
            chatScreen.appendChild(reflectionDiv);
            
            const buttonDiv = document.createElement('div');
            buttonDiv.className = 'button-group';
            buttonDiv.innerHTML = `
                <button class="button" onclick="nextCase()">
                    ${currentCaseIndex < narrativeCases.length - 1 ? 'Continue to Next Case ‚Üí' : 'Complete Survey and View Results ‚Üí'}
                </button>
            `;
            const descriptionDiv = document.createElement('div');
            descriptionDiv.innerHTML = `
                    <h3 style="margin: 30px 0 10px 0; text-align: center; color: #333;">What's Next?</h3>
                    <p style="color: #666; font-size: 1em; text-align: center; max-width: 600px; margin: 0 auto;">
                        Please complete the follow-up survey to help us improve this learning experience and contribute to research in AI and interprofessional ethical practice.
                    </p>
                    `;
            if (currentCaseIndex === narrativeCases.length - 1) {
                chatScreen.appendChild(descriptionDiv);
            }
            chatScreen.appendChild(buttonDiv);
            
            
            scrollToBottom();
        }

        function nextCase() {
            currentCaseIndex++;
            
            if (currentCaseIndex < narrativeCases.length) {
                loadCase();
            } else {
                showResults();
                window.open('https://uwo.eu.qualtrics.com/jfe/form/SV_cM7zaVus1dE3NnU', '_blank');
            }
        }

        function scrollToBottom() {
            const content = document.getElementById('content');
            setTimeout(() => {
                content.scrollTop = content.scrollHeight;
            }, 100);
        }

        function showResults() {
            document.getElementById('chat-screen').classList.add('hidden');
            const resultsScreen = document.getElementById('results-screen');
            resultsScreen.classList.remove('hidden');
            
            const correctCount = userResponses.filter(r => r.isCorrect).length;
            const percentage = Math.round((correctCount / narrativeCases.length) * 100);
            
            // Calculate category breakdown
            const categoryBreakdown = {
                uncertainty: { correct: 0, total: 0 },
                dilemma: { correct: 0, total: 0 },
                distress: { correct: 0, total: 0 }
            };

            userResponses.forEach(r => {
                categoryBreakdown[r.correctAnswer].total++;
                if (r.isCorrect) categoryBreakdown[r.correctAnswer].correct++;
            });
            
            // Generate personalized message
            let message = '';
            if (percentage === 100) {
                message = "üåü <strong>Outstanding!</strong> You've demonstrated exceptional understanding of ethical challenges in healthcare. Your ability to distinguish between uncertainty, dilemmas, and distress shows sophisticated ethical reasoning that will serve you well in interprofessional practice.";
            } else if (percentage >= 80) {
                message = "üí™ <strong>Excellent work!</strong> You have a strong grasp of ethical concepts. ";
                const uncertaintyMistakes = userResponses.filter(r => !r.isCorrect && r.correctAnswer === 'uncertainty').length;
                const dilemmaMistakes = userResponses.filter(r => !r.isCorrect && r.correctAnswer === 'dilemma').length;
                const distressMistakes = userResponses.filter(r => !r.isCorrect && r.correctAnswer === 'distress').length;
                
                if (uncertaintyMistakes > dilemmaMistakes && uncertaintyMistakes > distressMistakes) {
                    message += "Consider reviewing scenarios involving <strong>ethical uncertainty</strong>‚Äîremember, this occurs when you're unsure which principle applies, not when you're choosing between known principles.";
                } else if (dilemmaMistakes > distressMistakes) {
                    message += "Focus on <strong>ethical dilemmas</strong> in your continued learning‚Äîthese involve choosing between two valid principles, not just feeling conflicted.";
                } else {
                    message += "Pay special attention to <strong>ethical distress</strong> situations‚Äîthese occur when you know what's right but can't act due to external constraints.";
                }
            } else {
                message = "üéØ <strong>You're developing your ethical reasoning!</strong> This is challenging material, and every healthcare professional continues learning throughout their career. ";
                const maxMistakes = Math.max(
                    userResponses.filter(r => !r.isCorrect && r.correctAnswer === 'uncertainty').length,
                    userResponses.filter(r => !r.isCorrect && r.correctAnswer === 'dilemma').length,
                    userResponses.filter(r => !r.isCorrect && r.correctAnswer === 'distress').length
                );
                
                if (maxMistakes === userResponses.filter(r => !r.isCorrect && r.correctAnswer === 'uncertainty').length) {
                    message += "<strong>Ethical uncertainty</strong> can be tricky to identify. Remember: it's about not knowing which principle applies, while dilemmas involve choosing between known principles.";
                } else if (maxMistakes === userResponses.filter(r => !r.isCorrect && r.correctAnswer === 'dilemma').length) {
                    message += "<strong>Ethical dilemmas</strong> specifically involve conflicts between two or more valid ethical principles‚Äînot just any difficult decision.";
                } else {
                    message += "<strong>Ethical distress</strong> has a specific definition: knowing the right thing to do but being unable to act due to external constraints. This differs from uncertainty (not knowing) and dilemmas (choosing between options).";
                }
            }
            
            resultsScreen.innerHTML = `
                <h2 style="text-align: center; color: #333; margin-bottom: 20px;">üéì Journey Complete!</h2>
                
                <div class="results-summary">
                    <div class="results-score">${percentage}%</div>
                    <div style="color: #666; font-size: 1.1em;">
                        ${correctCount} out of ${narrativeCases.length} correct
                    </div>
                </div>

                <div class="feedback-bubble">
                    <div class="feedback-text" style="font-size: 1.05em; text-align: center;">
                        ${message}
                    </div>
                </div>

                <h3 style="margin: 30px 0 20px 0; text-align: center; color: #333;">Performance by Category</h3>
                <div class="stat-grid">
                    <div class="stat-card">
                        <div class="stat-value">${categoryBreakdown.uncertainty.correct}/${categoryBreakdown.uncertainty.total}</div>
                        <div class="stat-label">Ethical Uncertainty</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${categoryBreakdown.dilemma.correct}/${categoryBreakdown.dilemma.total}</div>
                        <div class="stat-label">Ethical Dilemma</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${categoryBreakdown.distress.correct}/${categoryBreakdown.distress.total}</div>
                        <div class="stat-label">Ethical Distress</div>
                    </div>
                </div>

                <div>
                    <h3 style="margin: 30px 0 10px 0; text-align: center; color: #333;">What's Next?</h3>
                    <p style="color: #666; font-size: 1em; text-align: center; max-width: 600px; margin: 0 auto;">
                        Please complete the follow-up survey to help us improve this learning experience and contribute to research in AI and interprofessional ethical practice.
                    </p>
                </div>

                <div class="button-group" style="margin-top: 30px;">
                    <button class="button" onclick="downloadResults()">üì• Download Results</button>
                </div>
            `;
            
            scrollToBottom();
        }

        function downloadResults() {
            const correctCount = userResponses.filter(r => r.isCorrect).length;
            const percentage = Math.round((correctCount / narrativeCases.length) * 100);
            
            let report = `INTERPROFESSIONAL ETHICAL PRACTICE - LEARNING REPORT
Generated: ${new Date().toLocaleString()}

OVERALL PERFORMANCE
Score: ${correctCount}/${narrativeCases.length} (${percentage}%)

DETAILED RESPONSES
${'='.repeat(80)}

`;

            userResponses.forEach((response, index) => {
                const caseData = narrativeCases[index];
                report += `CASE ${index + 1} - ${caseData.profession} (${caseData.difficulty})
Your Answer: ${response.selectedAnswer.toUpperCase()}
Correct Answer: ${response.correctAnswer.toUpperCase()}
Result: ${response.isCorrect ? 'CORRECT ‚úì' : 'INCORRECT ‚úó'}

${'-'.repeat(80)}

`;
            });

            const blob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Ethical_Practice_Results_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>